---
title: "Session 1: Introduction to Transport Data Science"
bibliography: ../tds.bib
toc: true
execute: 
  cache: true
  warning: false
  message: false
---


## Agenda {.unnumbered}

1.  Lecture: an introduction to Transport Data Science (30 min)
    -   See the [slides](slides.html)
2.  Q&A (15 min) <!-- - Introduction to the module and team - 30 min
        Each person to say  1) their name and where they are based 2) why they took the module and 3) their level of knowledge of coding. -->
3.  Break and networking (15 min) <!-- 3. Practical (2 hrs) -->
4.  Data science and a good research question (30 min)
5.  Data science foundations (guided): Project set-up and using RStudio or VS Code as an integrated development environment (30 min)
6.  Focussed work (1 hr)
        <!-- 1. Bonus: Work through [Chapter 5](https://r4ds.had.co.nz/transform.html#filter-rows-with-filter) of R for Data Science -->

# What is transport data science and thinking of a good research question {.unnumbered}

-   Based on the contents of the lecture, come up with *your own* definition of data science
-   How do you see yourself using data science over the next 5 years?
-   Think of a question about a transport system you know well and how data science could help answer it, perhaps with reference to a sketch like that below

## How to come up with a good research question {.unnumbered}

-   Think about the data you have access to
-   Think about the problems you want to solve
-   Think about the methods you want to use and skills you want to learn
-   Think about how the final report will look and hold-together

#### How much potential is there for cycling across the transport network? {.unnumbered}

![](https://user-images.githubusercontent.com/1825120/127524923-7d9f5511-84a6-430b-8de9-a603a5524f39.png)

#### How can travel to schools be made safer? {.unnumbered}

#### How can hospitals encourage visitors to get there safely? {.unnumbered}

#### Where's the best place to build electric car charging points? {.unnumbered}

See [openstreetmap.org](https://www.openstreetmap.org/#map=19/53.80689/-1.55637) or search for other open access datasets for more ideas



# Data Science foundations

-   Review of [homework](../d1/)

-   Create a new folder (or R project with RStudio) called 'session1'

-   In it create file called foundations.qmd

-   Type the following

```{asis}
This is some text:

casualty_type = c("pedestrian", "cyclist", "cat")
casualty_age = seq(from = 20, to = 60, by = 20)
```

-   Knit the document by pressing Ctrl+Shift+K in RStudio or VS Code, with the 'Knit' button in RStudio, or by typing `quarto render foundations.qmd` in the PowerShell or Terminal console, the result should look like this (see @fig-rstudio-foundations):

::: {#fig-rstudio-foundations}

![](images/rstudio-foundations.png)

Illustration of the RStudio interface with a .qmd file open in the top left, the console in the bottom left, the environment in the top right and the files in the bottom right.

:::

The document you are reading is a Quarto document, so we can show the output of the contents of the code in `foundations.qmd` here:

```{r}
casualty_type = c("pedestrian", "cyclist", "cat")
casualty_age = seq(from = 20, to = 60, by = 20)
crashes = data.frame(casualty_type, casualty_age)
nrow(crashes)

```

There are different ways to execute code.
When you run the code by 'compiling' the document, the objects are created in a different session.
For interactive data analysis, it is better to run the code in the console.

Make sure that you also execute the code in the console so that the objects are created in memory.
Do that by placing the cursor in the code chunk and pressing Ctrl+Enter (or Cmd+Enter on a Mac) or by copying and pasting the code into the console (not recommended).
We now have a data frame object stored in memory (technically in the global environment) that is used as the basis of the questions.

Next, add to the data frame you created by adding the following code to the code chunk in the .qmd file:

```{r}
vehicle_type = c("car", "bus", "tank")
crashes$vehicle_type = vehicle_type
```

What just happened?

We will explore this together, and then you can try the following data manipulation exercises:

## Data object manipulation basics

1.  Use the `$` operator to print the `vehicle_type` column of `crashes`.

<details>

In R the `$` symbol is used to refer to elemements of a list.
So the answer is simply:

```{r}
crashes$vehicle_type
```

</details>

2.  Subset the crashes with the `[,]` syntax

<details>

Try out different combinations on the dataframe `crashes` to see what happens.
For example, try:

```{r}
crashes[1,]
crashes[,1]
crashes[1,1]
```

3.  Subset the object with the `[[` syntax.

<details>

The `[[` operator is used to extract elements from a list.
Try:

```{r}
crashes[[1]]
crashes[[2]]
```

</details>

4.  **Bonus**: what is the `class()` of the objects created by each of the previous exercises?

-   Explore how many R classes you can find

5.  **Bonus** (advanced): reproduce the above with Python using the `pandas` or `polars` package

## Data science on real data

Work through the following example on road traffic data (recommended for most people) or the NTS data (for people more interested in travel survey data).
You can do both if you have time.

### UK Road Safety Data

To get some larger datasets, try the following (from Chapter 8 of [RSRR](https://itsleeds.github.io/rrsrr/)):

::: {.panel-tabset group="language"}
## R

```{r}
remotes::install_cran("stats19")
library(stats19)
ac = get_stats19(year = 2020, type = "collision")
ca = get_stats19(year = 2020, type = "cas")
ve = get_stats19(year = 2020, type = "veh")
# population hurt by road traffic collisions in 2020:
(nrow(ca) / 67e6) * 100
```

## Python

Challenge: reproduce the above code in Python using the `pystats19` package

``` python
# Install the package, e.g. with pip
!pip install pystats19
import pystats19
# See the documentation at https://github.com/Mayazure/py-stats19
```
:::

Let's go through these exercises together:

1.  Subset the `casualty_age` object using the inequality (`<`) so that only elements less than 50 are returned.
2.  Subset the `crashes` data frame so that only tanks are returned using the `==` operator.
3.  **Bonus**: assign the age of all tanks to 61.

-   Try running the subsetting code on a larger dataset, e.g. the `ac` object created previously

1.  Coerce the `vehicle_type` column of `crashes` to the class `character`.
2.  Coerce the `crashes` object into a matrix. What happened to the values?
3.  **Bonus:** What is the difference between the output of `summary()` on `character` and `factor` variables?

-   We'll explore this together
## National Travel Survey 

### UK National Travel Survey (NTS) data

<details>

Note: you will need to download the modified NTS 2022 data from your Minerva module page and place it in your working directory for this section to work.

```{r import_dataset}
#| eval: false
# Read CSV file
NTS_data <- read.csv("NTS2022_modifieddata.csv")

# Look at the column names
names(NTS_data)

# Look at the data
head(NTS_data)
```

You should see something like this:

```
> names(NTS_data)
 [1] "IndividualID"            "avg_trip_length"
 [3] "avg_trip_length_weekday" "avg_trip_length_weekend"
 [5] "total_distance"          "total_distance_weekday"
 [7] "total_distance_weekend"  "SD_triplength"
 [9] "sd_Total_Distance_wknd"  "sd_Total_Distance_wk"
 
 > head(NTS_data)
  IndividualID avg_trip_length avg_trip_length_weekday avg_trip_length_weekend
1   2023000001        4.080000                4.631579                2.333333
2   2023000002        2.538462                2.400000                3.000000
3   2023000003        5.916667                6.250000                5.250000
```

Visualising datasets is important when dealing with large volumes of data, as visualisations help convey complex information in an easily interpretable format. Consider the histogram plots of average trip lengths over a week in the UK.

```{r avg-triplength-histogram, message=FALSE, warning=FALSE}
#| eval: false
# Note: This requires ggplot2 library to be loaded first
library(tidyverse) # Tidyverse contains ggplot2 and other useful packages
ggplot(NTS_data, aes(x = avg_trip_length)) +
  geom_histogram(binwidth = 1, fill = "darkgrey") +
  labs(
    title = "Avg. Trip Length in Whole Week",
    x = "Trip Length (km)",
    y = "Number of Individuals"
  ) +
  theme_minimal() +
  xlim(0, 50) 
```

Data exploration or "exploratory data analysis" (EDA) involves examining datasets in depth to uncover underlying patterns or differences. The direction of this investigation is largely guided by the research question.

Consider different histogram plots for weekdays and weekends. Can you identify any differences between them? (Clue: Check the number of individuals between 0-1 Km)

Think: What could be plausible reasons for such difference?

```{r avg-triplength-weekday-histogram, message=FALSE, warning=FALSE}
#| eval: false
ggplot(NTS_data, aes(x = avg_trip_length_weekday)) +
  geom_histogram(binwidth = 1, fill = "darkblue") + 
  labs(
    title = "Avg. Trip Length on Weekdays",
    x = "Trip Length (km)",
    y = "Number of Individuals"
  ) +
  theme_minimal() +
  xlim(0, 50) 
```

```{r avg-triplength-weekend-histogram, message=FALSE, warning=FALSE}
#| eval: false
ggplot(NTS_data, aes(x = avg_trip_length_weekend)) +
  geom_histogram(binwidth = 1, fill = "darkred") + 
  labs(
    title = "Avg. Trip Length on Weekends",
    x = "Trip Length (km)",
    y = "Number of Individuals"
  ) +
  theme_minimal() +
  xlim(0, 50) 
```

You can more easily compare the two histograms when they are placed in the same plot, with transparency added to the bars:

```{r avg-triplength-weekday-weekend-histogram, message=FALSE, warning=FALSE}
#| eval: false
g_combined = ggplot() +
  geom_histogram(data = NTS_data, aes(x = avg_trip_length_weekday), 
                 binwidth = 1, fill = "darkblue", alpha = 0.5) + 
  geom_histogram(data = NTS_data, aes(x = avg_trip_length_weekend), 
                 binwidth = 1, fill = "darkred", alpha = 0.5) + 
  labs(
    title = "Avg. Trip Length on Weekdays (blue) and Weekends (red)",
    x = "Trip Length (km)",
    y = "Number of Individuals"
  ) +
  theme_minimal() +
  xlim(0, 50)
# Then 'print' the plot to show it:
g_combined
```

You can save the plot with `ggsave()`:

```{r}
#| eval: false
ggsave("avg_trip_length_weekday_weekend.png", plot = g_combined, width = 8, height = 6)
```

And (this is how you can show figures in Quarto), in a quarto document (.qmd file) that you will use to write and submit your coursework, you can include the saved figure like this (we will come onto this later in the module):

```
![](avg_trip_length_weekday_weekend.png)
```

![Avg. Trip Length on Weekdays (blue) and Weekends (red)](images/avg_trip_length_weekday_weekend.png)

```{r}
#| eval: false
#| echo: false
# move the file:
file.rename("avg_trip_length_weekday_weekend.png", "s1/images/avg_trip_length_weekday_weekend.png")
```

Don't they largely look the same? Can you stop here and infer that the trip length distributions for weekdays and weekends are largely similar? You might, depending on the resources at your disposal, but from an academic point of view we need to think about other potential dimensions where they could be different.

Consider different histogram plots for 'Standard Deviation' of trip lengths over weekdays and weekends. Can you identify any differences between them? (Clue: Again, check the number of individuals with SD 0-2 Km)

Think: What could be plausible reasons for such difference?

```{r SD-triplength-weekday-histogram, message=FALSE, warning=FALSE}
#| eval: false
ggplot(NTS_data, aes(x = sd_Total_Distance_wk)) +
  geom_histogram(binwidth = 0.5, fill = "darkblue") + 
  labs(
    title = "SD of Trip Length on Weekdays",
    x = "SD of trip length (km)",
    y = "Number of Individuals"
  ) +
  theme_minimal() +
  xlim(0, 25) + ylim(0,1000) 
```

```{r SD-triplength-weekend-histogram, message=FALSE, warning=FALSE}
#| eval: false
ggplot(NTS_data, aes(x = sd_Total_Distance_wknd)) +
  geom_histogram(binwidth = 0.5, fill = "darkred") + 
  labs(
    title = "SD of Trip Length on Weekends",
    x = "SD of trip length (km)",
    y = "Number of Individuals"
  ) +
  theme_minimal() +
  xlim(0, 25) + ylim(0,1000) 
```

</details>

# Self-study practical (1 hr)

**Read and try to complete the exercises in Chapters 1 to 5 of the book [Reproducible Road Safety Research with R](https://itsleeds.github.io/rrsrr/).**

It assumes that you have recently updated R and RStudio on your computer.
For details on installing packages see [here](https://docs.ropensci.org/stats19/articles/stats19-training-setup.html).

```{asis}
<!-- ## Tidyverse

-   Work through Chapter 5 starting with the following code: -->
```

<!-- library(tidyverse) # Load the package -->

## Bonus: data science and transport

- Work through [Chapter 13](https://r.geocompx.org/transport.html) of the book Geocomputation with R, taking care to ask questions about any aspects that you don't understand (your homework will be to complete and make notes on the chapter, including reproducible code).

# Homework

- Reproduce the code I wrote during this session, e.g. by copy-pasting this code into the console or source editor of RStudio: [github.com/github.com/itsleeds/tds/blob/main/s1/s1project/foundations.qmd](https://github.com/itsleeds/tds/blob/main/s1/s1project/foundations.qmd)
  - See the raw file at [github.com/itsleeds/tds/raw/refs/heads/main/s1/s1project/foundations.qmd](https://github.com/itsleeds/tds/raw/refs/heads/main/s1/s1project/foundations.qmd)
  - See the rendered result at [itsleeds.github.io/tds/s1/s1project/foundations.html](https://itsleeds.github.io/tds/s1/s1project/foundations.html)

-   Work through [Chapter 13](https://r.geocompx.org/transport.html) of the Geocomputation with R book. Make notes in a .qmd file that you can bring to the class to show colleagues and the instructor next week.

-   Think of a research question that you could answer with data science, and write it down in a .qmd file. Include a sketch of the data you would need to answer the question.

-   Sign-up to the Cadence platform as outlined at [itsleeds.github.io/tds/s2/#the-cadence-platform](https://itsleeds.github.io/tds/s2/#the-cadence-platform)
