---
output:
  pdf_document:
    number_sections: true
title: Transport Data Science with R Practical Exercises
---

These practicals aim to test your knowledge of material covered in the Transport Data Science module hosted at https://github.com/ITSLeeds/TDS

It will use the following packages:

```{r, message=FALSE, warning=FALSE}
library(dplyr)
library(osmdata)
library(sf)
library(stplanr)
library(tmap)
```

# Project set-up

- Check your packages are up-to-date with `update.packages()`
- Create an RStudio project with an appropriate name for this course (e.g. `TDSwithR`)
- Create a script called `set-up.R`, e.g. with **one** the following commands:

```r
file.edit("get-transport-data.R") 
```

# Getting transport data

## Accessing crowd-sourced data from OSM

- Type code into the script created in the previous section so that it can reproduce this plot: 

```{r, message=FALSE, warning=FALSE, out.height="5cm"}
location = opq("leeds") %>% 
  add_osm_feature(key = "railway", value = "station") %>% 
  osmdata_sf()
station_points = location$osm_points["name"]
tm_shape(location$osm_polygons) +
  tm_polygons(col = "red") +
  tm_shape(station_points) +
  tm_dots(col = "red")  +
  tm_text(text = "name", size = 1) 
```

```{r, echo=FALSE, eval=FALSE}
write_sf(station_points, "station_points.gpkg")
piggyback::pb_upload("station_points.gpkg")
```

1. Download cycleway data with the tag highway=cycleway for Leeds from https://overpass-turbo.eu/
1. Load the data in R and plot it with `tmap` (bonus: now try to get the same data using the **osmdata** package)


## Get official data with stats19 and pct packages

1. Download and plot all crashes reported in Great Britain in 2017 (hint: see [the stats19 vignette](https://cran.r-project.org/web/packages/stats19/vignettes/stats19.html))
1. Filter crashes that happened in West Yorkshire
1. Get and plot origin-destination data with the `pct` package hosted at: https://github.com/ITSLeeds/pct (bonus: look at the source code of `get_od()` and download the origin-destination data with `download.file()`)

## Bonus exercises

Identify a region and zonal units of interest from http://geoportal.statistics.gov.uk/

1. Read them into R as an `sf` object
1. Join-on data from a non-geographic object
1. Add a data access section to your in progress portfolio
1. Get origin-destination data from Uber

# Working with spatio-temporal data 

1. Create an object representing desire lines in West Yorkshire, e.g, with: `desire_lines_all = pct::get_pct_lines(region = "west-yorkshire")`


# Traffic data and pollution analysis with R  

See exercises in lecture slides.

# From desire lines to route networks 


1. Identify the top 10 desire lines in West Yorkshire along which at least 100 people travel to work (se starting hint code below)
  - Bonus: 
